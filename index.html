<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>⚡ project silica 404sec (Quick Connect)</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    body {
      background: #000; color: #0f0;
      font-family: monospace; padding: 20px;
    }
    #peerArea, #quickConnect, #connections, #chatbox, #bottom {
      margin-bottom: 10px;
    }
    button, input {
      background: #111; color: #0f0;
      border: 1px solid #0f0; padding: 6px;
    }
    .message { display: flex; align-items: center; margin: 6px 0; }
    .avatar {
      width: 32px; height: 32px; margin-right: 8px;
      border: 1px solid #0f0; border-radius: 4px;
    }
    .text { line-height: 1.2; }
    .system { opacity: 0.6; font-style: italic; }
  </style>
</head>
<body>

  <!-- untiedlaces , 02 3 , bxr ,hd -->

  <h2>⚡ project silica 404sec</h2>

  <!-- display your own peer ID and copy it -->
  <div id="peerArea">
    Your ID: <input id="my-id" readonly size="20" />
    <button id="copyIdBtn">Copy ID</button>
  </div>

  <!-- quick-connect buttons for 5 permanent IDs -->
  <div id="quickConnect">
    <strong>Quick Connect:</strong>
    <!-- buttons injected here -->
  </div>

  <!-- show who you're connected to -->
  <div id="connections"><strong>Active Peers:</strong></div>

  <!-- chat log -->
  <div id="chatbox" style="border:1px solid #0f0; padding:8px; height:200px; overflow:auto"></div>

  <!-- send message -->
  <div id="bottom">
    <input id="messageInput" placeholder="Type message…" size="40" />
    <button id="sendBtn" disabled>Send</button>
  </div>

  <script>
  (function(){
    // replace these with your actual “room” or friend IDs
    const QUICK_IDS = ['room1','room2','room3','room4','room5'];

    // P2P setup
    const peer = new Peer();          // random ID
    const connections = {};          
    const idInput = document.getElementById('my-id');
    const connDiv = document.getElementById('connections');
    const sendBtn = document.getElementById('sendBtn');

    peer.on('open', id => {
      idInput.value = id;
    });

    // handle incoming
    peer.on('connection', c => {
      if (!connections[c.peer]) setupConnection(c);
    });

    // copy your ID
    document.getElementById('copyIdBtn').onclick = () => {
      navigator.clipboard.writeText(idInput.value)
        .then(()=>alert('Copied!'));
    };

    // inject quick-connect buttons
    const qc = document.getElementById('quickConnect');
    QUICK_IDS.forEach(fid => {
      const btn = document.createElement('button');
      btn.textContent = 'Connect ' + fid;
      btn.onclick = () => connectToPeer(fid);
      qc.appendChild(btn);
    });

    // connect helper
    function connectToPeer(friendId) {
      if (connections[friendId] || friendId === peer.id) return;
      const c = peer.connect(friendId);
      c.on('open', () => setupConnection(c));
    }

    // set up new DataConnection
    function setupConnection(c) {
      connections[c.peer] = c;
      renderConnections();
      appendSystemMsg(`Connected to ${c.peer}`);
      c.on('data', d => appendMessage(d, false));
      c.on('close', () => {
        delete connections[c.peer];
        renderConnections();
        appendSystemMsg(`${c.peer} disconnected`);
      });
    }

    // update active-peers list
    function renderConnections() {
      connDiv.innerHTML = '<strong>Active Peers:</strong>';
      const ids = Object.keys(connections);
      if (!ids.length) {
        connDiv.innerHTML += ' <span class="system">none</span>';
      }
      ids.forEach(id => {
        const span = document.createElement('span');
        span.textContent = ' ' + id;
        connDiv.appendChild(span);
      });
      sendBtn.disabled = !ids.length;
    }

    // send chat
    sendBtn.onclick = () => {
      const input = document.getElementById('messageInput');
      const text = input.value.trim();
      if (!text) return;
      const msg = { user: idInput.value, text };
      appendMessage(msg, true);
      Object.values(connections).forEach(c => c.send(msg));
      input.value = '';
    };

    // display incoming or outgoing
    function appendMessage(data, isYou) {
      const div = document.createElement('div');
      div.className = 'message';
      div.innerHTML = 
        `<div class="text">
           <strong>${isYou?'You':data.user}:</strong> ${data.text}
         </div>`;
      document.getElementById('chatbox').appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function appendSystemMsg(msg) {
      const div = document.createElement('div');
      div.className = 'text system';
      div.textContent = msg;
      document.getElementById('chatbox').appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }
  })();
  </script>
</body>
</html>
