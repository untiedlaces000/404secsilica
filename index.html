<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚ö° project silica 404sec (Enhanced)</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body {
      background: #000; color: #0f0;
      font-family: monospace; display: flex;
      flex-direction: column; height: 100vh;
    }
    h2 { padding: 16px; text-align: center }
    /* Full-screen overlays */
    #avatarPicker, #lockScreen {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 1000; color: #0f0;
    }
    #avatarPicker.active, #lockScreen.active { display: flex }
    #avatarGrid {
      display: grid; grid-template-columns: repeat(3,1fr);
      gap: 12px; margin: 16px 0;
    }
    #avatarGrid img {
      width: 80px; height: 80px; cursor: pointer;
      border: 2px solid #0f0; border-radius: 8px;
      transition: transform .2s;
    }
    #avatarGrid img:hover { transform: scale(1.1) }
    .avatar-option { margin: 8px 0 }
    /* Layout sections */
    .panel { padding: 12px 16px; }
    .flex { display: flex; align-items: center; gap: 8px }
    .flex-wrap { display: flex; flex-wrap: wrap; gap: 8px }
    input, button { 
      background: #111; color: #0f0;
      border: 1px solid #0f0; padding: 8px;
      font-size: 1em; font-family: monospace;
    }
    input[readonly] { opacity: .8; cursor: text }
    button { cursor: pointer; transition: opacity .2s }
    button:disabled { opacity: .4; cursor: not-allowed }
    /* Quick connect buttons */
    #quickConnect button { min-width: 80px }
    /* Active peers list */
    #connections .conn-item {
      padding: 4px 8px; margin: 4px 0;
      border: 1px solid #0f0; border-radius: 4px;
      display: flex; justify-content: space-between;
    }
    /* Chat window */
    #chatbox {
      flex: 1; background: #111;
      margin: 0 16px; padding: 12px;
      overflow-y: auto; border: 1px solid #0f0;
    }
    .message {
      display: flex; align-items: flex-start;
      margin-bottom: 8px;
    }
    .message .avatar-thumb {
      width: 32px; height: 32px;
      border: 1px solid #0f0; border-radius: 4px;
      margin-right: 8px;
    }
    .message .text { line-height: 1.3 }
    .message .text .user { font-weight: bold }
    .system { font-style: italic; opacity: .6; margin: 4px 16px }
    /* Bottom bar */
    #bottom { 
      padding: 12px 16px; background: #000;
      display: flex; gap: 8px;
    }
  </style>
</head>
<body oncontextmenu="return false;">

  <!-- untiedlaces , 02 3 , bxr ,hd -->

  <!-- Avatar Picker -->
  <div id="avatarPicker" class="active">
    <h3>üßô Pick Your Avatar</h3>
    <div id="avatarGrid"></div>
    <div class="avatar-option flex">
      <button id="refreshAvatars">üîÑ Refresh</button>
      <button id="blackAvatar">Black Avatar</button>
      <input id="customURL" placeholder="Custom URL" />
      <button id="customOk">OK</button>
    </div>
    <small>powered by Dicebear or your own URL</small>
  </div>

  <!-- Lock Screen -->
  <div id="lockScreen">
    <h3>üîê Enter Password</h3>
    <form id="unlockForm" class="flex">
      <input type="password" id="passwordInput" placeholder="Password" autocomplete="off" />
      <button type="submit">Unlock</button>
    </form>
    <div id="passwordMsg" class="system"></div>
  </div>

  <h2>‚ö° project silica 404sec</h2>

  <!-- Peer Info -->
  <div id="peerArea" class="panel flex">
    <span>Your ID:</span>
    <input id="myId" readonly size="20" />
    <button id="copyIdBtn">Copy</button>
  </div>

  <!-- Quick-Connect -->
  <div id="quickConnect" class="panel flex-wrap">
    <strong>Quick Connect:</strong>
  </div>

  <!-- Manual Connect -->
  <div id="manualConnect" class="panel flex">
    <input id="friendId" placeholder="Friend ID‚Ä¶" size="20" />
    <button id="connectManualBtn">Connect</button>
  </div>

  <!-- Active Peers -->
  <div id="connections" class="panel">
    <strong>Active Peers:</strong>
  </div>

  <!-- Chat -->
  <div id="chatbox"></div>

  <!-- Message Input -->
  <div id="bottom">
    <input id="messageInput" placeholder="Type a message‚Ä¶" />
    <button id="sendBtn" disabled>Send</button>
  </div>

  <script>
  (function(){
    // CONFIG  
    const PASSWORD = ':)00@';
    const QUICK_IDS = ['peer-A','peer-B','peer-C','peer-D','peer-E'];

    // DOM  
    const avatarPicker = document.getElementById('avatarPicker');
    const lockScreen    = document.getElementById('lockScreen');
    const avatarGrid    = document.getElementById('avatarGrid');
    const pwdInput      = document.getElementById('passwordInput');
    const pwdMsg        = document.getElementById('passwordMsg');
    const refreshBtn    = document.getElementById('refreshAvatars');
    const blackBtn      = document.getElementById('blackAvatar');
    const customURL     = document.getElementById('customURL');
    const customOkBtn   = document.getElementById('customOk');
    const unlockForm    = document.getElementById('unlockForm');

    const myIdInput     = document.getElementById('myId');
    const copyIdBtn     = document.getElementById('copyIdBtn');
    const quickConnect  = document.getElementById('quickConnect');
    const friendIdInput = document.getElementById('friendId');
    const manualBtn     = document.getElementById('connectManualBtn');

    const connectionsEl = document.getElementById('connections');
    const chatbox       = document.getElementById('chatbox');
    const msgInput      = document.getElementById('messageInput');
    const sendBtn       = document.getElementById('sendBtn');

    // STATE  
    let avatarURL = '';
    const username = prompt('Choose your username:')?.trim() || 'Anonymous';

    // UTIL  
    function logSystem(text) {
      const el = document.createElement('div');
      el.className = 'system';
      el.textContent = text;
      chatbox.appendChild(el);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function renderMessage({user,avatar,text}, isSelf) {
      const row = document.createElement('div');
      row.className = 'message';
      row.innerHTML = `
        <img class="avatar-thumb" src="${avatar}" />
        <div class="text">
          <div class="user">${isSelf? 'You': user}</div>
          <div>${text}</div>
        </div>`;
      chatbox.appendChild(row);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // AVATAR PICKER  
    const avatarStyles = ["fun-emoji","pixel-art","bottts","identicon","adventurer","croodles"];
    function shuffleAvatars() {
      avatarGrid.innerHTML = '';
      for (let i=0; i<9; i++) {
        const style = avatarStyles[Math.floor(Math.random()*avatarStyles.length)];
        const seed  = username.replace(/\W/g,'').toLowerCase()+Math.random();
        const img   = document.createElement('img');
        img.src     = `https://api.dicebear.com/7.x/${style}/svg?seed=${seed}`;
        img.onclick = () => selectAvatar(img.src);
        avatarGrid.appendChild(img);
      }
    }
    function selectAvatar(url) {
      avatarURL = url;
      avatarPicker.classList.remove('active');
      lockScreen.classList.add('active');
    }
    function useCustom() {
      const url = customURL.value.trim();
      if (url) selectAvatar(url);
    }
    refreshBtn.onclick  = shuffleAvatars;
    blackBtn.onclick    = () => selectAvatar('https://via.placeholder.com/40/000');
    customOkBtn.onclick = useCustom;
    shuffleAvatars();

    // LOCK SCREEN  
    unlockForm.addEventListener('submit', e => {
      e.preventDefault();
      if (pwdInput.value === PASSWORD) {
        lockScreen.classList.remove('active');
        logSystem('Welcome, '+username);
      } else {
        pwdMsg.textContent = '‚ùå Wrong password';
      }
    });

    // PEERJS  
    const peer = new Peer();
    const conns = {};

    peer.on('open', id => {
      myIdInput.value = id;
    });
    peer.on('connection', conn => openConnection(conn));

    // COPY ID  
    copyIdBtn.onclick = () => {
      navigator.clipboard.writeText(myIdInput.value)
        .then(()=> logSystem('Copied your ID'));
    };

    // QUICK CONNECT  
    QUICK_IDS.forEach(fid => {
      const btn = document.createElement('button');
      btn.textContent = fid;
      btn.onclick     = () => connectTo(fid);
      quickConnect.appendChild(btn);
    });

    // MANUAL CONNECT  
    manualBtn.onclick = () => connectTo(friendIdInput.value.trim());

    function connectTo(id) {
      if (!id || id === peer.id || conns[id]) return;
      const conn = peer.connect(id);
      conn.on('open', () => openConnection(conn));
    }

    function openConnection(conn) {
      conns[conn.peer] = conn;
      updateConnections();
      logSystem('‚úÖ Connected to ' + conn.peer);
      conn.on('data', data => renderMessage(data, false));
      conn.on('close', () => {
        delete conns[conn.peer];
        updateConnections();
        logSystem('‚ùå Disconnected from ' + conn.peer);
      });
    }

    function updateConnections() {
      connectionsEl.innerHTML = '<strong>Active Peers:</strong>';
      const peers = Object.keys(conns);
      if (!peers.length) {
        connectionsEl.innerHTML += ' <span class="system">none</span>';
        sendBtn.disabled = true;
        return;
      }
      peers.forEach(id => {
        const item = document.createElement('div');
        item.className = 'conn-item';
        item.innerHTML = `
          <span>${id}</span>
          <button onclick="dropConnection('${id}')">‚úñ</button>`;
        connectionsEl.appendChild(item);
      });
      sendBtn.disabled = false;
    }
    window.dropConnection = id => {
      conns[id].close();
      delete conns[id];
      updateConnections();
      logSystem('‚ùå You dropped ' + id);
    };

    // CHAT  
    sendBtn.onclick = () => {
      const text = msgInput.value.trim();
      if (!text) return;
      const msg = { user: username, avatar: avatarURL, text };
      renderMessage(msg, true);
      Object.values(conns).forEach(c => c.send(msg));
      msgInput.value = '';
    };

  })();
  </script>
</body>
</html>
