<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>⚡ project silica 404sec (Fixed Buttons)</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body {
      background: #000; color: #0f0;
      font-family: monospace; display: flex;
      flex-direction: column; height: 100vh;
    }
    h2 { padding: 16px; text-align: center }
    /* Fullscreen overlays */
    #avatarPicker, #lockScreen {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.95);
      display: none; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 1000;
    }
    #avatarPicker.active, #lockScreen.active { display: flex }
    #avatarGrid {
      display: grid; grid-template-columns: repeat(3,1fr);
      gap: 12px; margin: 16px 0;
    }
    #avatarGrid img {
      width: 80px; height: 80px; cursor: pointer;
      border: 2px solid #0f0; border-radius: 8px;
      transition: transform .2s;
    }
    #avatarGrid img:hover { transform: scale(1.1) }
    .avatar-option { margin: 8px 0 }
    .panel { padding: 8px 16px }
    .flex { display: flex; gap: 8px; align-items: center }
    input, button { 
      background: #111; color: #0f0;
      border: 1px solid #0f0; padding: 6px 10px;
      font-family: monospace; font-size: 1em;
    }
    button:disabled { opacity: .4; cursor: not-allowed }
    /* Active peers, chat, bottom */
    #connections .conn-item {
      padding: 4px 8px; margin: 4px 0;
      border: 1px solid #0f0; border-radius: 4px;
      display: flex; justify-content: space-between;
    }
    #chatbox {
      flex: 1; background: #111;
      margin: 0 16px; padding: 12px;
      overflow-y: auto; border: 1px solid #0f0;
    }
    .message { display: flex; margin-bottom: 8px; }
    .avatar-thumb {
      width: 32px; height: 32px;
      border: 1px solid #0f0; border-radius: 4px;
      margin-right: 8px;
    }
    .text { line-height: 1.3 }
    .user { font-weight: bold }
    .system { font-style: italic; opacity: .6; margin: 4px 16px }
    #bottom { padding: 8px 16px; display: flex; gap: 8px; }
  </style>
</head>
<body oncontextmenu="return false;">

  <!-- untiedlaces , 02 3 , bxr ,hd -->

  <div id="avatarPicker" class="active">
    <h3>🧙 Pick Your Avatar</h3>
    <div id="avatarGrid"></div>
    <div class="avatar-option flex">
      <button id="refreshAvatars">🔄 Refresh</button>
      <button id="blackAvatar">Black Avatar</button>
      <input id="customURL" placeholder="Custom URL" />
      <button id="customOk">OK</button>
    </div>
    <small>powered by Dicebear or your own URL</small>
  </div>

  <div id="lockScreen">
    <h3>🔐 Enter Password</h3>
    <form id="unlockForm" class="flex">
      <input type="password" id="passwordInput" placeholder="Password" autocomplete="off" />
      <button type="submit">Unlock</button>
    </form>
    <div id="passwordMsg" class="system"></div>
  </div>

  <h2>⚡ project silica 404sec</h2>

  <!-- Peer Info -->
  <div id="peerArea" class="panel flex">
    <span>Your ID:</span>
    <input id="myId" readonly size="20" />
    <button id="copyIdBtn">Copy</button>
  </div>

  <!-- Quick Connect -->
  <div id="quickConnect" class="panel flex">
    <strong>Quick:</strong>
  </div>

  <!-- Manual Connect -->
  <div id="manualConnect" class="panel flex">
    <input id="friendId" placeholder="Friend ID…" size="20" />
    <button id="connectManualBtn">Connect</button>
  </div>

  <!-- Active Peers -->
  <div id="connections" class="panel">
    <strong>Active Peers:</strong>
  </div>

  <!-- Chat -->
  <div id="chatbox"></div>

  <!-- Bottom bar -->
  <div id="bottom">
    <input id="messageInput" placeholder="Type a message…" />
    <button id="sendBtn" disabled>Send</button>
  </div>

  <script>
    // ——————————————
    // GLOBAL STATE & UTILS
    // ——————————————
    const PASSWORD    = ':)00@';
    const QUICK_IDS   = ['peer-A','peer-B','peer-C','peer-D','peer-E'];
    let avatarURL     = '';
    const username    = prompt('Your name?')?.trim() || 'Anon';
    const conns       = {};
    const peer        = new Peer();

    function logSystem(text) {
      const div = document.createElement('div');
      div.className = 'system';
      div.textContent = text;
      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function renderMessage({user,avatar,text}, self) {
      const row = document.createElement('div');
      row.className = 'message';
      row.innerHTML = `
        <img class="avatar-thumb" src="${avatar}" />
        <div class="text">
          <div class="user">${self?'You':user}</div>
          <div>${text}</div>
        </div>`;
      chatbox.appendChild(row);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // ——————————————
    // AVATAR PICKER
    // ——————————————
    function refreshAvatars() {
      avatarGrid.innerHTML = '';
      const styles = ["fun-emoji","pixel-art","bottts","identicon","adventurer","croodles"];
      for (let i=0; i<9; i++) {
        const style = styles[Math.floor(Math.random()*styles.length)];
        const seed  = username.replace(/\W/g,'').toLowerCase() + Math.random();
        const img   = document.createElement('img');
        img.src     = `https://api.dicebear.com/7.x/${style}/svg?seed=${seed}`;
        img.onclick = () => selectAvatar(img.src);
        avatarGrid.appendChild(img);
      }
    }

    function selectAvatar(url) {
      avatarURL = url;
      avatarPicker.classList.remove('active');
      lockScreen.classList.add('active');
    }

    function useBlackAvatar() {
      selectAvatar('https://via.placeholder.com/40/000');
    }

    function useCustomURL() {
      const val = customURL.value.trim();
      if (val) selectAvatar(val);
    }

    // ——————————————
    // LOCK SCREEN
    // ——————————————
    unlockForm.addEventListener('submit', e => {
      e.preventDefault();
      if (passwordInput.value === PASSWORD) {
        lockScreen.classList.remove('active');
        logSystem(`Welcome, ${username}`);
      } else {
        passwordMsg.textContent = '❌ Wrong password';
      }
    });

    // ——————————————
    // PEER CONNECTIONS
    // ——————————————
    peer.on('open', id => myId.value = id);
    peer.on('connection', conn => openConn(conn));

    function connectTo(id) {
      if (!id || id === peer.id || conns[id]) return;
      const c = peer.connect(id);
      c.on('open', () => openConn(c));
    }

    function openConn(conn) {
      conns[conn.peer] = conn;
      updateConnections();
      logSystem(`✅ Connected to ${conn.peer}`);
      conn.on('data', data => renderMessage(data, false));
      conn.on('close', () => {
        delete conns[conn.peer];
        updateConnections();
        logSystem(`❌ Disconnected ${conn.peer}`);
      });
    }

    function updateConnections() {
      connections.innerHTML = '<strong>Active Peers:</strong>';
      const ids = Object.keys(conns);
      ids.forEach(id => {
        const div = document.createElement('div');
        div.className = 'conn-item';
        div.innerHTML = `
          <span>${id}</span>
          <button onclick="drop('${id}')">✖</button>`;
        connections.appendChild(div);
      });
      sendBtn.disabled = ids.length === 0;
      if (ids.length === 0) {
        connections.innerHTML += ' <span class="system">none</span>';
      }
    }

    function drop(id) {
      conns[id].close();
      delete conns[id];
      updateConnections();
      logSystem(`❌ You dropped ${id}`);
    }

    // ——————————————
    // CHAT
    // ——————————————
    sendBtn.addEventListener('click', () => {
      const text = messageInput.value.trim();
      if (!text) return;
      const msg = { user: username, avatar: avatarURL, text };
      renderMessage(msg, true);
      Object.values(conns).forEach(c => c.send(msg));
      messageInput.value = '';
    });

    // ——————————————
    // EVENT BINDING
    // ——————————————
    window.refreshAvatars = refreshAvatars;
    window.useBlackAvatar = useBlackAvatar;
    window.useCustomURL  = useCustomURL;
    window.connectTo     = connectTo;
    window.drop          = drop;

    copyIdBtn.addEventListener('click', () =>
      navigator.clipboard.writeText(myId.value).then(_=> logSystem('Copied ID'))
    );

    connectManualBtn.addEventListener('click', () =>
      connectTo(friendId.value.trim())
    );

    // build quick-connect buttons
    QUICK_IDS.forEach(fid => {
      const btn = document.createElement('button');
      btn.textContent = fid;
      btn.addEventListener('click', () => connectTo(fid));
      quickConnect.appendChild(btn);
    });

    // initial avatars
    refreshAvatars();
  </script>
</body>
</html>
